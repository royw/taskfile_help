version: '3'

tasks:

  default:
    cmds:
      - task: serve
    silent: true

  # === Documentation ===

  generate-tests:
    desc: Generate test documentation table from test docstrings
    summary: Extracts test info and creates docs/tests.md
    cmds:
      - cmd: echo "üìù Generating test documentation..."
        silent: true
      - python3 scripts/generate_test_docs.py

  build:
    desc: Build documentation with MkDocs
    summary: Generates static documentation site in site/ directory
    deps:
      - generate-tests
    cmds:
      - cmd: echo "üìö Building documentation..."
        silent: true
      - cmd: |
          set -o pipefail
          uv run mkdocs build --strict {{.CLI_ARGS}} 2>&1 | grep -v "MERMAID2.*Found superfences config" | grep -v "MERMAID2.*Initialization arguments" | grep -v "MERMAID2.*Using javascript library"
      - cmd: echo "‚úÖ Documentation built successfully in site/"
        silent: true

  serve:
    desc: Serve documentation locally for development (default docs task)
    summary: Starts local server with live reload at http://127.0.0.1:8000
    cmds:
      - cmd: echo "üåç Starting documentation server..."
        silent: true
      - uv run mkdocs serve {{.CLI_ARGS}}

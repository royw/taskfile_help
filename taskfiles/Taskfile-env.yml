version: '3'

tasks:

  default:
    cmds:
      - task: check
    silent: true

  # === Setup and Environment ===

  check:
    desc: Verify development environment setup (default env task)
    summary: Checks versions of required tools (python3, uv, task)
    cmds:
      - cmd: echo "Checking Prerequisite versions..."
        silent: true
      - uv --version
      - uv run python --version
      - git --version
      - pipx --version
      - pymarkdownlnt version
    silent: true

  install:
    desc: Install project dependencies (first-time setup) into .venv/
    summary: First-time setup - checks environment and syncs dependencies
    deps:
      - check
      - sync
    silent: true

  sync:
    desc: Sync project dependencies with uv into .venv/
    summary: Updates dependencies from pyproject.toml into .venv/
    cmds:
      - uv sync --group dev
    silent: true

  resync:
    desc: Resync project dependencies by first deleting .venv/ and then syncing with uv into .venv/
    summary: Clean reinstall - removes .venv/ and syncs fresh
    cmds:
      - rm -rf .venv/
      - task: sync
    silent: true

  clean:
    desc: Clean up generated files
    summary: Removes __pycache__, .pyc, .pytest_cache, .ruff_cache, dist/
    cmds:
      - find . -type d -name "__pycache__" -exec rm -rf {} +
      - find . -type f -name "*.pyc" -delete
      - rm -rf .mypy_cache/
      - rm -rf .pytest_cache/
      - rm -rf dist/
      - rm -rf build/
      - rm -rf site/
    silent: true

  # === Help ===
  help:
    desc: Show available tasks from this Taskfile
    summary: Displays environment setup and cleanup tasks
    cmd: taskfile-help env
    silent: true
